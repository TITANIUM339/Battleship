(()=>{"use strict";class e{#e;#t=0;constructor(e){if("number"!=typeof e||e<1||e>10)throw new Error("length must be a number between 1 - 10");this.#e=e}get length(){return this.#e}get hits(){return this.#t}hit(){this.#t++}isSunk(){return this.#t===this.#e}}class t{#r=[];#n={};#s=[];#a=[];constructor(){for(let e=0;e<10;e++){this.#r[e]=[];for(let t=0;t<10;t++)this.#r[e][t]={attacked:!1,ship:null}}}placeShip(t,r,n,s){if("string"!=typeof t)throw new Error("name must be a string");if(Object.prototype.hasOwnProperty.call(this.#n,t))throw new Error("name must be unique");const[a,i]=r;if(a>9||a<0||i>9||i<0)throw new Error("invalid coordinate");if("number"!=typeof n||0!==n&&1!==n)throw new Error("orientation must be 0 or 1");for(let e=0;e<s;e++)if(0===n){if(a+e>9||null!==this.#r[a+e][i].ship)return!1}else if(i+e>9||null!==this.#r[a][i+e].ship)return!1;this.#n[t]=new e(s),this.#s.push([t,s]);for(let e=0;e<s;e++)0===n?this.#r[a+e][i].ship=t:this.#r[a][i+e].ship=t;return!0}receiveAttack(e){const[t,r]=e;if(t>9||t<0||r>9||r<0)return 0;const n=this.#r[t][r];if(n.attacked)return 0;if(n.attacked=!0,null!==n.ship){if(this.#n[n.ship].hit(),this.#n[n.ship].isSunk()){const e=[];for(let t=0;t<10;t++)for(let r=0;r<10;r++)this.#r[r][t].ship===n.ship&&e.push([r,t]);for(let e=0;e<this.#s.length;e++)this.#s[e][0]===n.ship&&this.#s.splice(e,1);return this.#a.push([n.ship,e]),3}return 2}return 1}allShipsAreSunk(){let e=0;for(const t in this.#n)this.#n[t].isSunk()&&e++;return e===Object.keys(this.#n).length}get unSunkShips(){return JSON.parse(JSON.stringify(this.#s))}get sunkShips(){return JSON.parse(JSON.stringify(this.#a))}get board(){return JSON.parse(JSON.stringify(this.#r))}}function r(e){const r=[];for(let e=0;e<10;e++)for(let t=0;t<10;t++)r.push([t,e]);let n=0;const s=new t;do{const t=r.splice(Math.floor(Math.random()*r.length),1)[0],a=Math.floor(2*Math.random());s.placeShip(e[n].ship,t,a,e[n].length)&&n++}while(n!==e.length);return s}class n{static#i=!0;static#l=!1;static#o={player1:null,player2:null};#c;#h;constructor(e,r){if("string"!=typeof e)throw new Error("name must be a string");if(!(r instanceof t))throw new Error("board must be an instance of GameBoard");this.#c=e,null===n.#o.player1?(n.#o.player1=r,this.#h=!0):(n.#o.player2=r,this.#h=!1)}static clearBoards(){this.#o.player1=null,this.#o.player2=null,this.#i=!0,this.#l=!1}attack(e){let t=0;if(this.#h&&n.#i?t=n.#o.player2?.receiveAttack(e)||0:!this.#h&&n.#l&&(t=n.#o.player1?.receiveAttack(e)||0),t){const e=n.#i;n.#i=n.#l,n.#l=e}return t}get enemyUnSunkShips(){return this.#h?n.#o.player2.unSunkShips:n.#o.player1.unSunkShips}get enemySunkShips(){return this.#h?n.#o.player2.sunkShips:n.#o.player1.sunkShips}get name(){return this.#c}get turn(){return this.#h?n.#i:n.#l}}class s{#d;#u=()=>{};constructor(e,t){if(!(e instanceof n))throw new Error("player must be an instance of Player");this.#d=e;for(let e=0;e<10;e++)for(let r=0;r<10;r++)t[r][e].addEventListener("click",(()=>{this.#d.attack([r,e])&&this.#u()}))}play(){return new Promise((e=>{this.#u=e}))}}class a{#r=Array.from(Array(10),(()=>new Array(10).fill(!0)));#p=!1;#t=[];#y=null;#f=null;#m;#d;constructor(e){if(!(e instanceof n))throw new Error("player must be an instance of Player");this.#d=e,this.#m=this.#g()}#g(){const e=this.#d.enemyUnSunkShips;let t=1;for(let r=0;r<e.length;r++)e[r][1]>t&&(t=e[r][1]);const r=Array.from(Array(10),(()=>new Array(10).fill(!1)));let n=0,s=0,a=0;for(;10!==s;)r[n][s]=!0,n+=t,n>9&&(s++,a++,a=a===t?0:a,n=a);return r}#S(e){const[t,r]=e,n=[[t+1,r],[t,r-1],[t-1,r],[t,r+1]],s=[];for(let e=0;e<n.length;e++){const[t,r]=n[e];t<=9&&t>=0&&this.#r[t][r]&&s.push(n[e])}return s[Math.floor(Math.random()*s.length)]}#b(){const e=[];for(let t=0;t<10;t++)for(let r=0;r<10;r++)this.#r[r][t]&&this.#m[r][t]&&e.push([r,t]);return e[Math.floor(Math.random()*e.length)]}#k(e){const[t,r]=e,n=this.#d.attack(e);switch(n&&(this.#r[t][r]=!1),n){case 3:{const e=this.#d.enemySunkShips,t=e[e.length-1][1];for(let e=0;e<t.length;e++){const[r,n]=t[e];for(let e=0;e<this.#t.length;e++){const[t,s]=this.#t[e];if(r===t&&n===s){this.#t.splice(e,1);break}}}this.#m=this.#g(),this.#p=!1,this.#y=this.#f=null;break}case 2:this.#t.push(e)}return n}play(e=this.#b()){return new Promise((t=>setTimeout((()=>{(()=>{if(this.#p){const[e,t]=this.#y,[r,n]=this.#f;let s=e===r?[r,n+1]:[r+1,n],a=this.#k(s);if(2===a&&(this.#f=s),a)return;if(s=e===r?[r,n-1]:[r-1,n],a=this.#k(s),2===a&&(this.#f=s),a)return;if(s=e===r?[e,t+1]:[e+1,t],a=this.#k(s),2===a&&(this.#y=s),a)return;if(s=e===r?[e,t-1]:[e-1,t],a=this.#k(s),2===a&&(this.#y=s),a)return;this.#p=!1,this.#y=this.#f=null}if(this.#t.length){null===this.#y&&(this.#y=this.#t[this.#t.length-1]);const e=this.#S(this.#y);2===this.#k(e)&&(this.#f=this.#t[this.#t.length-1],this.#p=!0)}else this.#k(e)})(),t()}),600)))}}const i=(()=>{const e=document.querySelector(".content"),i=document.querySelector(".message");function l(){const e=document.createElement("div");e.className="board";const t=document.createElement("div");t.className="letters";const r=document.createElement("div");r.className="numbers";for(let e=0;e<10;e++){const n=document.createElement("div");n.innerText=String.fromCharCode(65+e);const s=document.createElement("div");s.innerText=e+1,t.appendChild(n),r.appendChild(s)}const n=document.createElement("div");n.className="grid";for(let e=0;e<10;e++)for(let t=0;t<10;t++){const r=document.createElement("div");r.className="cell",r.dataset.x=t,r.dataset.y=e,r.appendChild(document.createElement("div")),n.appendChild(r)}return e.appendChild(t),e.appendChild(r),e.appendChild(n),e}let o=null,c=[];function h(){for(let e=0;e<c.length;e++)c[e].classList.remove("valid"),c[e].classList.remove("invalid");c=[]}function d(e){const t=document.createElement("div");t.className="ships",t.addEventListener("dragstart",(e=>{e.preventDefault()}));for(let r=0;r<e.length;r++){const n=document.createElement("div");n.className="ship",n.draggable=!0,n.dataset.name=e[r].ship,n.dataset.length=e[r].length;const s=document.createElement("div");s.innerText=e[r].ship,s.addEventListener("dragstart",(e=>{e.stopPropagation(),e.preventDefault()}));const a=document.createElement("div");a.innerText=e[r].length,a.addEventListener("dragstart",(e=>{e.stopPropagation(),e.preventDefault()})),n.addEventListener("dragstart",(e=>{e.stopPropagation(),o=e.target,e.dataTransfer.setData("text","")})),n.addEventListener("dragend",(function(){o=null,h()})),n.appendChild(s),n.appendChild(a),t.append(n)}return t}function u(e){const t=Array.from(Array(10),(()=>new Array(10)));for(let r=0,n=0;r<10;r++)for(let s=0;s<10;s++)t[s][r]=e[n++];return t}function p(e,t,r){for(let n=0;n<10;n++)for(let s=0;s<10;s++)null!==r&&t[n][s].ship===r&&e[n][s].classList.add("occupied"),t[n][s].attacked&&null!==t[n][s].ship?e[n][s].firstChild.classList.add("hit"):t[n][s].attacked&&e[n][s].firstChild.classList.add("miss")}function y(e,t){for(let r=0;r<10;r++)for(let n=0;n<10;n++)null!==t[r][n].ship&&e[r][n].classList.add("occupied")}function f(e,t,r){function n(e){for(let t=0;t<r.length;t++)if(e===r[t][0])return!0;return!1}for(let r=0;r<10;r++)for(let s=0;s<10;s++)n(t[r][s].ship)&&e[r][s].classList.remove("occupied")}return{loadStart:async function(){try{e.innerHTML=await(await fetch("./pages/start.html")).text()}catch{return Promise.reject("Network Error")}i.innerText="";const t=e.querySelector("#player1"),r=e.querySelector("#player2"),n=e.querySelector("#computer1"),s=e.querySelector("#computer2");return new Promise((a=>{e.querySelector("form").addEventListener("submit",(e=>{e.preventDefault(),e.target.checkValidity()&&a({player1:{name:t.value,computer:n.checked},player2:{name:r.value,computer:s.checked}})}))}))},loadConfigure:async function(n,s){try{e.innerHTML=await(await fetch("./pages/configure.html")).text()}catch{return Promise.reject("Network Error")}i.innerText=`Configure your fleet, ${n}`,e.querySelector(".board-container").appendChild(l());const a=e.querySelector(".ships-container > :first-child");a.appendChild(d(s));const p=u(e.querySelectorAll(".cell")),y=e.querySelector("#axis");let f=!0,m=[];for(let e=0;e<10;e++)for(let t=0;t<10;t++)p[t][e].addEventListener("dragover",(e=>{f&&e.preventDefault()})),p[t][e].addEventListener("dragenter",(()=>{if(!o)return;h(),f=!0;const r=o.dataset.length;for(let n=0;n<r;n++)if(y.checked){if(e+n>9||p[t][e+n].classList.contains("occupied")){f=!1;break}c.push(p[t][e+n])}else{if(t+n>9||p[t+n][e].classList.contains("occupied")){f=!1;break}c.push(p[t+n][e])}for(let e=0;e<c.length;e++)f?c[e].classList.add("valid"):c[e].classList.add("invalid")})),p[t][e].addEventListener("drop",(e=>{if(e.preventDefault(),!f)return;o.remove();const t={name:o.dataset.name,coordinate:[Number(e.target.dataset.x),Number(e.target.dataset.y)],orientation:y.checked?1:0,length:Number(o.dataset.length)};m.push(t);for(let e=0;e<c.length;e++)c[e].classList.add("occupied")}));let g=null;return e.querySelector(".random").addEventListener("click",(()=>{for(let e=0;e<10;e++)for(let t=0;t<10;t++)p[t][e].classList.remove("occupied");a.innerHTML="",g=r(s);for(let e=0;e<10;e++)for(let t=0;t<10;t++)null!==g.board[t][e].ship&&p[t][e].classList.add("occupied")})),e.querySelector(".reset").addEventListener("click",(()=>{m=[],g=null;for(let e=0;e<10;e++)for(let t=0;t<10;t++)p[t][e].classList.remove("occupied");a.replaceChildren(d(s))})),new Promise((r=>{e.querySelector(".done").addEventListener("click",(()=>{if(g)r(g);else if(m.length===s.length){const e=new t;for(let t=0;t<m.length;t++)e.placeShip(m[t].name,m[t].coordinate,m[t].orientation,m[t].length);r(e)}}))}))},loadGame:async function({player1:t,player1Board:r,computer1:o},{player2:c,player2Board:h,computer2:d}){try{e.innerHTML=await(await fetch("./pages/game.html")).text()}catch{return Promise.reject("Network Error")}e.querySelector(".player1 > .board-container").appendChild(l()),e.querySelector(".player2 > .board-container").appendChild(l()),e.querySelector(".player1").querySelector(".name").innerText=`${t.name}`,e.querySelector(".player2").querySelector(".name").innerText=`${c.name}`;const m=u(e.querySelector(".player1").querySelectorAll(".cell")),g=u(e.querySelector(".player2").querySelectorAll(".cell")),S=e.querySelector(".player1 > .toggle-board"),b=e.querySelector(".player2 > .toggle-board");o||d?o&&d||y(o?g:m,o?h.board:r.board):(S.classList.remove("hide"),b.classList.remove("hide"));let k=!1;S.addEventListener("click",(e=>{e.target.classList.contains("disabled")||(k?(f(m,r.board,r.unSunkShips),e.target.innerText="Show board",k=!1):(y(m,r.board),e.target.innerText="Hide board",k=!0))}));let v=!1;b.addEventListener("click",(e=>{e.target.classList.contains("disabled")||(v?(f(g,h.board,h.unSunkShips),e.target.innerText="Show board",v=!1):(y(g,h.board),e.target.innerText="Hide board",v=!0))}));const w=o?new a(t):new s(t,g),L=d?new a(c):new s(c,m);return new Promise((s=>{let a=!1;e.querySelector(".restart").addEventListener("click",(()=>{n.clearBoards(),a=!0,s()})),(async()=>{for(;!r.allShipsAreSunk()&&!h.allShipsAreSunk()&&!a;){i.innerText=`${t.turn?t.name:c.name}'s turn`,o||d||(t.turn?(S.classList.remove("disabled"),b.classList.add("disabled"),f(g,h.board,h.unSunkShips)):(b.classList.remove("disabled"),S.classList.add("disabled"),f(m,r.board,r.unSunkShips)),k=v=!1,S.innerText=b.innerText="Show board"),t.turn?await w.play():await L.play();const e=t.turn?r.sunkShips[r.sunkShips.length-1]:h.sunkShips[h.sunkShips.length-1],n=e?e[0]:null;p(t.turn?m:g,t.turn?r.board:h.board,n)}a||(i.innerText=`${r.allShipsAreSunk()?c.name:t.name} wins!`)})()}))}}})();(async()=>{const e=document.querySelector(".card");document.querySelector(".info-button").addEventListener("click",(()=>{e.classList.remove("hide")})),document.querySelector(".close").addEventListener("click",(()=>{e.classList.add("hide")}));const t=[{ship:"carrier",length:5},{ship:"battleship",length:4},{ship:"cruiser",length:3},{ship:"submarine",length:3},{ship:"destroyer",length:2}];for(;;){const e=await i.loadStart(),s=e.player1.computer?r(t):await i.loadConfigure(e.player1.name,t),a=e.player2.computer?r(t):await i.loadConfigure(e.player2.name,t),l=new n(e.player1.name,s),o=new n(e.player2.name,a);await i.loadGame({player1:l,player1Board:s,computer1:e.player1.computer},{player2:o,player2Board:a,computer2:e.player2.computer})}})().catch((e=>{alert(e+". Try refreshing the page")}))})();